buildscript {
    repositories {
        mavenLocal()
        mavenCentral()
        maven { url "http://repository.jetbrains.com/repo/" }
    }
}

plugins {
    id "org.jetbrains.intellij" version "0.0.27"
}

version = '1.5.2.141'

repositories {
    mavenLocal()
    mavenCentral()
    maven { url "http://repository.jetbrains.com/repo/" }
}

apply plugin: 'org.jetbrains.intellij'

intellij {
    version '14.1.2'
    plugins 'IntelliLang'
    pluginName 'BashSupport'

    publish {
        username 'wallaby'
        pluginId '4230'
	password System.properties['intellij.publish.password']
    }
}

sourceCompatibility = "1.6"
targetCompatibility = "1.6"

sourceSets {
    main {
        java {
            srcDirs 'src'
        }
        resources {
            srcDir 'resources'
        }
    }
    test {
        java {
            srcDir 'test'
        }
        resources {
            srcDir 'testResources'
        }
    }
}

//test.ignoreFailures = true
test.testLogging.showStandardStreams = true

test {
    systemProperty "NO_FS_ROOTS_ACCESS_CHECK", "true"
}

allprojects {
    plugins.withType(JavaPlugin) {
        test {
            ignoreFailures = true
            systemProperty "NO_FS_ROOTS_ACCESS_CHECK", "true"
        }
    }
}

task wrapper(type: Wrapper) {
    gradleVersion = '2.6'
}

ant.importBuild("build.xml")

task doJFlex(dependsOn: JavaPlugin.PROCESS_RESOURCES_TASK_NAME) {
    doLast {
        jflex
    }
}

compileJava.dependsOn(doJFlex)
